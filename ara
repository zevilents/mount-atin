-- ===============================
-- RECORD & PLAYBACK MOVEMENT (Delta Executor Full Version)
-- ===============================

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")

-- Data rekaman
local recording = false
local playback = false
local recordData = {}

-- Nama file untuk save/load (Delta executor)
local SAVE_FILE = "movement_record.json"

-- GUI utama
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "RecordGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 250)
frame.Position = UDim2.new(0, 50, 0, 200)
frame.BackgroundColor3 = Color3.fromRGB(30,30,40)
frame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = frame

-- Layout tombol
local layout = Instance.new("UIListLayout")
layout.Parent = frame
layout.Padding = UDim.new(0,5)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Center

-- Fungsi buat tombol
local function createButton(text, color, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0,160,0,40)
    btn.Text = text
    btn.BackgroundColor3 = color
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    btn.Parent = frame
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0,8)
    btnCorner.Parent = btn
    
    btn.MouseButton1Click:Connect(callback)
end

-- Fungsi rekam
local function startRecord()
    recording = true
    recordData = {}
    print("[Recorder] Start recording...")
    
    local startTime = tick()
    task.spawn(function()
        while recording do
            local t = tick() - startTime
            table.insert(recordData, {
                time = t,
                cf = hrp.CFrame,
                vel = hrp.Velocity,
                jump = humanoid.Jump
            })
            RunService.Heartbeat:Wait()
        end
        print("[Recorder] Recording stopped. Frames:", #recordData)
    end)
end

local function stopRecord()
    recording = false
end

-- Fungsi playback
local function playRecord()
    if #recordData == 0 then
        warn("[Recorder] No data recorded!")
        return
    end
    playback = true
    print("[Recorder] Start playback...")
    
    local startTime = tick()
    for _, frameData in ipairs(recordData) do
        if not playback then break end
        
        local now = tick() - startTime
        local delay = frameData.time - now
        if delay > 0 then task.wait(delay) end
        
        hrp.CFrame = frameData.cf
        hrp.Velocity = frameData.vel
        
        if frameData.jump then
            humanoid.Jump = true
        end
    end
    print("[Recorder] Playback finished.")
    playback = false
end

local function stopPlayback()
    playback = false
end

-- Fungsi save/load file (khusus Delta)
local function saveRecordToFile()
    if #recordData == 0 then 
        warn("[Recorder] Nothing to save!")
        return 
    end
    local json = HttpService:JSONEncode(recordData)
    writefile(SAVE_FILE, json)
    print("[Recorder] Record saved to " .. SAVE_FILE)
end

local function loadRecordFromFile()
    if isfile(SAVE_FILE) then
        local json = readfile(SAVE_FILE)
        recordData = HttpService:JSONDecode(json)
        print("[Recorder] Record loaded from file! Frames:", #recordData)
    else
        warn("[Recorder] No saved file found.")
    end
end

-- Buat tombol GUI
createButton("âº Record", Color3.fromRGB(200,70,70), function()
    if not recording then startRecord() end
end)

createButton("â¹ Stop", Color3.fromRGB(100,100,100), function()
    if recording then
        stopRecord()
    elseif playback then
        stopPlayback()
    end
end)

createButton("â–¶ Play", Color3.fromRGB(70,150,70), function()
    if not playback then playRecord() end
end)

createButton("ðŸ’¾ Save File", Color3.fromRGB(70,70,200), function()
    saveRecordToFile()
end)

createButton("ðŸ“‚ Load File", Color3.fromRGB(200,200,70), function()
    loadRecordFromFile()
end)

print(">> GUI Record/Stop/Play/Save/Load siap digunakan <<")
