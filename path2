-- FINAL INPUT RECORDER (Rekam & Replay Obby)
-- Catat input keyboard (WASD + Space), replay dengan VirtualInputManager

local UIS = game:GetService("UserInputService")
local VIM = game:GetService("VirtualInputManager")
local HttpService = game:GetService("HttpService")

local recording = false
local playing = false
local recordData = {}
local startTime = 0

-- MULAI RECORD
function startRecording()
	recordData = {}
	startTime = tick()
	recording = true
	print("Recording started...")
end

-- STOP RECORD
function stopRecording()
	recording = false
	local json = HttpService:JSONEncode(recordData)
	writefile("obby_record.json", json) -- simpan permanen
	print("Recording stopped. Saved to obby_record.json")
end

-- PLAYBACK
function playRecording()
	if playing then return end
	local data = HttpService:JSONDecode(readfile("obby_record.json"))
	playing = true
	print("Playback started...")

	spawn(function()
		local last = tick()
		for _, input in ipairs(data) do
			local delayTime = input.t - (last - startTime)
			if delayTime > 0 then task.wait(delayTime) end

			if input.began then
				VIM:SendKeyEvent(true, input.key, false, game)
			else
				VIM:SendKeyEvent(false, input.key, false, game)
			end

			last = tick()
		end
		print("Playback finished.")
		playing = false
	end)
end

-- Rekam input
UIS.InputBegan:Connect(function(input, processed)
	if recording and not processed and input.UserInputType == Enum.UserInputType.Keyboard then
		table.insert(recordData, {
			key = input.KeyCode,
			began = true,
			t = tick() - startTime
		})
	end
end)

UIS.InputEnded:Connect(function(input, processed)
	if recording and not processed and input.UserInputType == Enum.UserInputType.Keyboard then
		table.insert(recordData, {
			key = input.KeyCode,
			began = false,
			t = tick() - startTime
		})
	end
end)

-- Hotkey
UIS.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.F5 then
		startRecording()
	elseif input.KeyCode == Enum.KeyCode.F6 then
		stopRecording()
	elseif input.KeyCode == Enum.KeyCode.F7 then
		playRecording()
	end
end)

print("Press F5 to Start Recording, F6 to Stop, F7 to Playback")
