-- ===============================
-- RECORD & PLAYBACK MOVEMENT (GUI, WALK LEGIT)
-- ===============================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")

-- Data rekaman
local recording = false
local playback = false
local recordData = {}

-- GUI utama
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "RecordGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 150)
frame.Position = UDim2.new(0, 50, 0, 200)
frame.BackgroundColor3 = Color3.fromRGB(30,30,40)
frame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = frame

-- Layout tombol
local layout = Instance.new("UIListLayout")
layout.Parent = frame
layout.Padding = UDim.new(0,5)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Center

-- Fungsi buat tombol
local function createButton(text, color, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0,160,0,40)
	btn.Text = text
	btn.BackgroundColor3 = color
	btn.TextColor3 = Color3.new(1,1,1)
	btn.Font = Enum.Font.GothamBold
	btn.TextSize = 18
	btn.Parent = frame
	
	local btnCorner = Instance.new("UICorner")
	btnCorner.CornerRadius = UDim.new(0,8)
	btnCorner.Parent = btn
	
	btn.MouseButton1Click:Connect(callback)
end

-- Fungsi rekam
local function startRecord()
	recording = true
	recordData = {}
	print("[Recorder] Start recording...")
	
	local startTime = tick()
	task.spawn(function()
		while recording do
			local t = tick() - startTime
			table.insert(recordData, {
				time = t,
				cf = hrp.CFrame,
				jump = humanoid.Jump
			})
			RunService.Heartbeat:Wait()
		end
		print("[Recorder] Recording stopped. Frames:", #recordData)
	end)
end

local function stopRecord()
	recording = false
end

-- Fungsi playback dengan jalan natural
local function playRecord()
	if #recordData == 0 then
		warn("[Recorder] No data recorded!")
		return
	end
	playback = true
	print("[Recorder] Start playback (walk mode)...")

	-- Reset posisi ke frame awal
	hrp.CFrame = recordData[1].cf
	local startTime = tick()

	for i = 1, #recordData - 1 do
		if not playback then break end

		local frameData = recordData[i]
		local nextFrame = recordData[i+1]

		-- Tunggu supaya timing sama
		local now = tick() - startTime
		local delay = frameData.time - now
		if delay > 0 then task.wait(delay) end

		-- Hitung perpindahan frame -> frame
		local startCF = frameData.cf
		local endCF = nextFrame.cf
		local duration = nextFrame.time - frameData.time
		if duration <= 0 then duration = 0.01 end

		-- Gerak smooth (lerp) selama durasi frame
		local elapsed = 0
		while elapsed < duration and playback do
			local alpha = elapsed / duration
			hrp.CFrame = startCF:Lerp(endCF, alpha)
			RunService.Heartbeat:Wait()
			elapsed = elapsed + RunService.Heartbeat:Wait()
		end

		-- Trigger jump bila ada
		if frameData.jump then
			humanoid.Jump = true
		end
	end

	print("[Recorder] Playback finished.")
	playback = false
end

local function stopPlayback()
	playback = false
end

-- Buat tombol GUI
createButton("⏺ Record", Color3.fromRGB(200,70,70), function()
	if not recording then startRecord() end
end)

createButton("⏹ Stop", Color3.fromRGB(100,100,100), function()
	if recording then
		stopRecord()
	elseif playback then
		stopPlayback()
	end
end)

createButton("▶ Play", Color3.fromRGB(70,150,70), function()
	if not playback then playRecord() end
end)

print(">> GUI Record/Stop/Play (walk mode) sudah siap <<")
