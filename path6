-- FINAL INPUT RECORDER (GUI + WASD + Jump Natural)
-- Simpan ke file, bisa replay 100% sesuai rekaman

local UIS = game:GetService("UserInputService")
local VIM = game:GetService("VirtualInputManager")
local HttpService = game:GetService("HttpService")

-- Tentukan parent GUI (agar muncul di semua executor)
local parentGui
if syn and syn.protect_gui then
    local gui = Instance.new("ScreenGui")
    syn.protect_gui(gui)
    gui.Parent = gethui()
    parentGui = gui
elseif gethui then
    parentGui = gethui()
else
    parentGui = game:GetService("CoreGui")
end

-- Hapus GUI lama jika ada
if parentGui:FindFirstChild("ObbyRecorder") then
	parentGui.ObbyRecorder:Destroy()
end

-- Buat GUI
local screen = Instance.new("ScreenGui")
screen.Name = "ObbyRecorder"
screen.ResetOnSpawn = false
screen.Parent = parentGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 220, 0, 160)
frame.Position = UDim2.new(0, 50, 0, 200)
frame.BackgroundColor3 = Color3.fromRGB(40,40,40)
frame.Parent = screen

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0,10)
corner.Parent = frame

-- Utility buat tombol
local function createBtn(txt, order, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, 200, 0, 40)
	btn.Position = UDim2.new(0, 10, 0, 10 + (order * 45))
	btn.Text = txt
	btn.BackgroundColor3 = Color3.fromRGB(70,130,255)
	btn.TextColor3 = Color3.new(1,1,1)
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 18
	btn.Parent = frame
	btn.MouseButton1Click:Connect(callback)

	local bcorner = Instance.new("UICorner")
	bcorner.CornerRadius = UDim.new(0,8)
	bcorner.Parent = btn
end

-- Recorder logic
local recording = false
local playing = false
local recordData = {}
local startTime = 0
local fileName = "obby_record.json"

-- mulai rekam
local function startRecording()
	if playing then return end
	recordData = {}
	startTime = tick()
	recording = true
	warn("🎥 Recording started...")
end

-- stop rekam + simpan file
local function stopRecording()
	if not recording then return end
	recording = false
	local json = HttpService:JSONEncode(recordData)
	writefile(fileName, json)
	warn("🛑 Recording stopped. Saved to " .. fileName)
end

-- replay file
local function playRecording()
	if playing or recording then return end
	if not isfile(fileName) then
		warn("⚠️ No saved record found!")
		return
	end

	local data = HttpService:JSONDecode(readfile(fileName))
	playing = true
	warn("▶️ Playback started...")

	spawn(function()
		local start = tick()
		for _, input in ipairs(data) do
			local waitTime = input.time - (tick() - start)
			if waitTime > 0 then
				task.wait(waitTime)
			end
			VIM:SendKeyEvent(input.began, input.key, false, game)
		end
		playing = false
		warn("✅ Playback finished.")
	end)
end

-- simpan input saat rekam
UIS.InputBegan:Connect(function(input, processed)
	if recording and not processed and input.UserInputType == Enum.UserInputType.Keyboard then
		table.insert(recordData, {
			key = input.KeyCode,
			began = true,
			time = tick() - startTime
		})
	end
end)

UIS.InputEnded:Connect(function(input, processed)
	if recording and not processed and input.UserInputType == Enum.UserInputType.Keyboard then
		table.insert(recordData, {
			key = input.KeyCode,
			began = false,
			time = tick() - startTime
		})
	end
end)

-- Tombol GUI
createBtn("🎥 Start Record", 0, startRecording)
createBtn("🛑 Stop Record", 1, stopRecording)
createBtn("▶️ Play Replay", 2, playRecording)
