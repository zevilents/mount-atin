-- [[ GUI + Pathfinding POS2 -> POS3 (koordinat update) ]]
local Players = game:GetService("Players")
local PathfindingService = game:GetService("PathfindingService")

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")

-- parent GUI (gethui support executor)
local parentGui = (gethui and gethui()) or game:GetService("CoreGui")

if parentGui:FindFirstChild("AutoPathGui") then
    parentGui.AutoPathGui:Destroy()
end

-- GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoPathGui"
screenGui.Parent = parentGui

local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0,220,0,44)
btn.Position = UDim2.new(0.5,-110,0.8,0)
btn.Text = "Jalan POS2 → POS3"
btn.BackgroundColor3 = Color3.fromRGB(50,150,255)
btn.TextColor3 = Color3.new(1,1,1)
btn.Font = Enum.Font.SourceSansBold
btn.TextSize = 18
btn.Parent = screenGui

-- POSISI TEST (update)
local pos2 = Vector3.new(-184, 128, 408)
local pos3 = Vector3.new(-166, 229, 652)

-- fungsi buat path
local function createPath(startPos, endPos)
    local path = PathfindingService:CreatePath({
        AgentHeight = 5,
        AgentRadius = 2,
        AgentCanJump = true
    })
    path:ComputeAsync(startPos, endPos)
    return path
end

-- fungsi ikuti path
local function followPath(path)
    if path.Status == Enum.PathStatus.Complete then
        local waypoints = path:GetWaypoints()
        for i, wp in ipairs(waypoints) do
            if wp.Action == Enum.PathWaypointAction.Jump then
                hum:ChangeState(Enum.HumanoidStateType.Jumping)
            end
            hum:MoveTo(wp.Position)
            hum.MoveToFinished:Wait()
        end
        print("✅ Sampai di POS3")
    else
        warn("❌ Path tidak valid!")
    end
end

-- tombol klik
btn.MouseButton1Click:Connect(function()
    -- teleport dulu ke pos2
    char:PivotTo(CFrame.new(pos2))
    task.wait(1)

    -- bikin path ke pos3
    local path = createPath(char.PrimaryPart.Position, pos3)
    followPath(path)
end)
